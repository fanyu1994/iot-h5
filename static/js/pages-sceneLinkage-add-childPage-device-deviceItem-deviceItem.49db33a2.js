(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-sceneLinkage-add-childPage-device-deviceItem-deviceItem"],{2345:function(e,t,i){var a=i("aca8");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("4f06").default;n("4f6a1afe",a,!0,{sourceMap:!1,shadowMode:!1})},"237c":function(e,t,i){e.exports=i.p+"static/img/侧窗.9384246f.svg"},"250c":function(e,t,i){e.exports=i.p+"static/img/天窗.b73dc34c.svg"},5761:function(e,t,i){e.exports=i.p+"static/img/高空虫情灯.6f3fbc96.svg"},"5e64":function(e,t,i){"use strict";var a=i("4ea4");i("99af"),i("4de4"),i("4160"),i("c975"),i("13d5"),i("a434"),i("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(i("2909")),r=a(i("f69c")),o={data:function(){return{isitemEdit:!1,form:[],formParam:[],props:{},list:[],imglist:{},isPd:!0,checked:!0,loading:!1,pWaterList:[],isP:!0,pValue:!0,isRadio:!1,expandOnCheckNode:!1,treelist1:[],expandKeys1:[],checkedKeys1:[],defaultProps1:{children:"children",label:"label"},treelist2:[],expandKeys2:[],checkedKeys2:[],defaultProps2:{children:"children",label:"label"},duration:"",delayTime:0,durationShow:!1,zdyShow:!1,zdyParams:{hour:!0,minute:!0,second:!0},durationList:[{value:"一直",label:"一直"},{value:"自定义",label:"自定义"}]}},components:{LyTree:r.default},created:function(){this.imglist={insideSun:i("e01e"),outSun:i("a516"),window_No1:i("250c"),window_No2:i("250c"),sideWindow_No2:i("237c"),sideWindow_No1:i("237c"),airCompressor_No1:i("e6da"),airCompressor_No2:i("e6da"),wetCurtain:i("877c"),hightLamp:i("5761")}},onLoad:function(e){this.props=JSON.parse(e.query),console.log("设备页-1",this.props),this.init(),this.props.isEdit&&(this.checked="开启"===this.props.instruct)},methods:{onInput:function(e){var t=this;if(this.checked=e,this.form.forEach((function(t){t.instruct=e?"开启":"关闭"})),this.formParam.forEach((function(t){t.instruct=e?"01":"00"})),this.props.isEdit){var i=this.$store.state.form.event,a=this.$store.state.formParam.event;i.forEach((function(n,r){n.nameId===t.props.nameId&&(i.splice(r,1,Object.assign({},n,{instruct:e?"开启":"关闭"})),a.splice(r,1,Object.assign({},t.$store.state.formParam.event[r],{instruct:e?"01":"00"})),t.form.push(Object.assign({},n,{instruct:e?"开启":"关闭"})),t.formParam.push(Object.assign({},t.$store.state.formParam.event[r],{instruct:e?"01":"00"})),console.log(n,t.form,t.formParam,"xxxxxxxxxx"))})),this.$store.commit("saveform",{form:{event:i},formParam:{event:a}})}},handleCheck1:function(e){var t=this;if(this.isP=!0,this.isitemEdit=!1,0===e.checkedKeys.length&&this.props.isEdit){this.form=[],this.formParam=[];var i=this.$store.state.form.event,a=this.$store.state.formParam.event;return i.forEach((function(e,n){console.log(i,e,8888888888),e.nameId&&-1!==e.nameId.indexOf(t.props.nameId)&&(i[n]["flag"]=!0,a[n]["flag"]=!0)})),i=i.filter((function(e){return!e.flag})),a=a.filter((function(e){return!e.flag})),this.$store.commit("saveform",{form:{event:i},formParam:{event:a}}),void(this.props.isitemEdit&&(this.isitemEdit=!0))}if(0===e.checkedKeys.length&&!this.props.isEdit){this.form=[],this.formParam=[];var n=this.$store.state.form.event,r=this.$store.state.formParam.event;return n.forEach((function(e,t){-1!==e.nameId.indexOf("pWater")&&(n[t]["flag"]=!0,r[t]["flag"]=!0)})),n=n.filter((function(e){return!e.flag})),r=r.filter((function(e){return!e.flag})),void this.$store.commit("saveform",{form:{event:n},formParam:{event:r}})}e.checkedKeys.forEach((function(e){t.pWaterList.forEach((function(i){i.id===e&&t.getChannel(i)}))})),this.$refs.tree2.setCheckAll(!1),this.form.forEach((function(e,i){-1!==e.nameId.indexOf("dWater")&&(t.form[i]["flag"]=!0,t.formParam[i]["flag"]=!0)})),this.form=this.form.filter((function(e){return!e.flag})),this.formParam=this.formParam.filter((function(e){return!e.flag}))},handleCheck2:function(e){var t=this;if(this.isP=!1,this.isitemEdit=!1,0===e.checkedKeys.length&&this.props.isEdit){this.form=[],this.formParam=[];var i=this.$store.state.form.event,a=this.$store.state.formParam.event;return i.forEach((function(e,n){e.nameId&&-1!==e.nameId.indexOf(t.props.nameId)&&(i[n]["flag"]=!0,a[n]["flag"]=!0)})),i=i.filter((function(e){return!e.flag})),a=a.filter((function(e){return!e.flag})),this.$store.commit("saveform",{form:{event:i},formParam:{event:a}}),void(this.props.isitemEdit&&(this.isitemEdit=!0))}if(0===e.checkedKeys.length&&!this.props.isEdit){this.form=[],this.formParam=[];var n=this.$store.state.form.event,r=this.$store.state.formParam.event;return n.forEach((function(e,t){-1!==e.nameId.indexOf("dWater")&&(n[t]["flag"]=!0,r[t]["flag"]=!0)})),n=n.filter((function(e){return!e.flag})),r=r.filter((function(e){return!e.flag})),void this.$store.commit("saveform",{form:{event:n},formParam:{event:r}})}e.checkedKeys.forEach((function(e){t.pWaterList.forEach((function(i){i.id===e&&t.getChannel(i)}))})),this.$refs.tree1.setCheckAll(!1),this.form.forEach((function(e,i){-1!==e.nameId.indexOf("pWater")&&(console.log(e.nameId),t.form[i]["flag"]=!0,t.formParam[i]["flag"]=!0)})),this.form=this.form.filter((function(e){return!e.flag})),this.formParam=this.formParam.filter((function(e){return!e.flag}))},checkallClear:function(e){var t=this.$store.state.form.event,i=this.$store.state.formParam.event;t.forEach((function(a,n){a.nameId&&-1!==a.nameId.indexOf(e)&&(t[n]["flag"]=!0,i[n]["flag"]=!0)})),t=t.filter((function(e){return!e.flag})),i=i.filter((function(e){return!e.flag})),this.$store.commit("saveform",{form:{event:t},formParam:{event:i}})},getChannel:function(e){var t=this,i=this.props.id;this.$http.post("/iot/tbDevice/queryDeviceChannelAttri/".concat(i,"/").concat(e.id)).then((function(i){if(200===i.data.code){var a=i.data.result.devcieList[0],n=t.isP?"喷灌":"滴灌";t.formParam.push({cabinetId:a.cabinetId,cabinetName:t.props.cabinetName,channelNo:a.deviceImei,channelName:"".concat(n,"-").concat(e.name),instruct:t.checked?"01":"00",delayTime:"",propertiesFlag:e.id,nameId:e.id,productKey:t.props.productKey}),t.form.push({cabinetId:"".concat(e.name,"(").concat(n,")"),instruct:t.checked?"开启":"关闭",id:a.cabinetId,nameId:e.id,cabinetName:t.props.cabinetName,productKey:t.props.productKey,channelNo:a.deviceImei,isPD:!0})}}))},init:function(){var e=this,t=this.props.productKey;this.$http.get("/iot/tbProduct/identification/".concat(t,"/properties")).then((function(t){200===t.data.code&&(e.list=t.data.result.filter((function(t){return"point"===t.id?(e.isPd=!0,e.getMore()):e.isPd=!1,"point"!==t.id})))}))},getMore:function(){var e=this;uni.setNavigationBarTitle({title:this.props.cabinetName||"详情"});var t=this.props.productKey;this.treelist1=[{id:"pWater",label:"喷灌",children:[]}],this.treelist2=[{id:"dWater",label:"滴灌",children:[]}],this.$http.get("/iot/tbProduct/identification/".concat(t,"/functions")).then((function(t){200===t.data.code&&(e.pWaterList=t.data.result,t.data.result.forEach((function(t,i){-1!==t.id.indexOf("pWater")?e.treelist1[0].children.push({id:t.id,label:t.name}):e.treelist2[0].children.push({id:t.id,label:t.name})})),e.treelist1=(0,n.default)(e.treelist1),e.treelist2=(0,n.default)(e.treelist2),e.props.isEdit&&(e.treelist1[0].children.forEach((function(t){t.id===e.props.nameId?(e.checkedKeys1.push(t.id),e.expandKeys1=["pWater"]):t["disabled"]=!0})),e.treelist2[0].children.forEach((function(t){t.id===e.props.nameId?(e.checkedKeys2.push(t.id),e.expandKeys2=["dWater"],console.log(e.checkedKeys2,e.expandKeys2)):t["disabled"]=!0}))))}))},durationClick:function(){this.durationShow=!0},durationConfirm:function(e){"自定义"===e[0].value?this.zdyShow=!0:(this.delayTime="",this.duration="一直")},zdyConfirm:function(e){var t=this;this.delayTime=60*e.hour*60*1e3+60*e.minute*1e3+1e3*e.second,this.duration="".concat(e.hour,":").concat(e.minute,":").concat(e.second),this.formParam.forEach((function(e){e.delayTime=t.delayTime})),console.log(e,this.delayTime,"zdyConfirm")},hold:function(){var e=this;if(this.props.isEdit&&!this.props.isitemEdit){var t=this.$store.state.form.event,i=this.$store.state.formParam.event;t.forEach((function(a,n){e.form.forEach((function(e,r){a.channelNo===e.channelNo&&(t[n]["flag"]=!0,i[n]["flag"]=!0)}))}));var a={},r={};return this.form=this.form.reduce((function(e,t){return!a[t.channelNo]&&(a[t.channelNo]=e.push(t)),e}),[]),this.formParam=this.formParam.reduce((function(e,t){return!r[t.channelNo]&&(r[t.channelNo]=e.push(t)),e}),[]),t=t.filter((function(e){return!e.flag})),i=i.filter((function(e){return!e.flag})),t=[].concat((0,n.default)(t),(0,n.default)(this.form)),i=[].concat((0,n.default)(i),(0,n.default)(this.formParam)),this.$store.commit("saveform",{form:{event:t},formParam:{event:i}}),void this.$Router.back()}if(this.props.isitemEdit){console.log("保存后的修改项,编辑");var o=this.$store.state.form.event,s=this.$store.state.formParam.event;o.forEach((function(t,i){e.form.forEach((function(e,a){t.channelNo===e.channelNo&&(o[i]["flag"]=!0,s[i]["flag"]=!0)}))}));var c={},d={};if(this.form=this.form.reduce((function(e,t){return!c[t.channelNo]&&(c[t.channelNo]=e.push(t)),e}),[]),this.formParam=this.formParam.reduce((function(e,t){return!d[t.channelNo]&&(d[t.channelNo]=e.push(t)),e}),[]),o=o.filter((function(e){return!e.flag})),s=s.filter((function(e){return!e.flag})),o=[].concat((0,n.default)(o),(0,n.default)(this.form)),s=[].concat((0,n.default)(s),(0,n.default)(this.formParam)),this.$store.commit("saveform",{form:{event:o},formParam:{event:s}}),this.isitemEdit)this.$http.delete("/rule/ruleTrigger/delete/".concat(this.props.triggerId));else{var f={cabinetId:this.formParam[0].cabinetId,cabinetName:this.form[0].cabinetName,channelName:this.form[0].cabinetId,channelNo:this.form[0].channelNo,instructContent:this.formParam[0].instruct,productKey:this.formParam[0].productKey,propertiesFlag:this.formParam[0].nameId,ruleId:this.props.rulesId,id:this.props.triggerId};this.$http.put("/rule/ruleTrigger/edit",f)}this.$Router.back()}else{if(this.props.isaddEdit){console.log("保存后的修改项,添加"),this.form.length&&-1!==this.form[0].nameId.indexOf("pWater")&&(console.log(this.form[0],86),this.checkallClear("dWater")),this.form.length&&-1!==this.form[0].nameId.indexOf("dWater")&&(console.log(this.form[0],96),this.checkallClear("pWater"));var l=this.$store.state.form.event,h=this.$store.state.formParam.event;l.forEach((function(t,i){e.form.forEach((function(e,a){t.channelNo===e.channelNo&&(l[i]["flag"]=!0,h[i]["flag"]=!0)}))})),l=l.filter((function(e){return!e.flag})),h=h.filter((function(e){return!e.flag}));var m={},u={};return this.form=this.form.reduce((function(e,t){return!m[t.channelNo]&&(m[t.channelNo]=e.push(t)),e}),[]),this.formParam=this.formParam.reduce((function(e,t){return!u[t.channelNo]&&(u[t.channelNo]=e.push(t)),e}),[]),l=[].concat((0,n.default)(l),(0,n.default)(this.form)),h=[].concat((0,n.default)(h),(0,n.default)(this.formParam)),this.$store.commit("saveform",{form:{event:l},formParam:{event:h}}),this.form.forEach((function(t,i){var a={cabinetId:e.formParam[i].cabinetId,cabinetName:e.form[i].cabinetName,channelName:e.form[i].channelName,channelNo:e.form[i].channelNo,instructContent:e.formParam[i].instruct,productKey:e.formParam[i].productKey,propertiesFlag:e.formParam[i].nameId,ruleId:e.props.rulesId,id:e.props.triggerId};e.$http.post("/rule/ruleTrigger/add",a)})),void history.go(-2)}this.form.length&&-1!==this.form[0].nameId.indexOf("pWater")&&(console.log(this.form[0],86),this.checkallClear("dWater")),this.form.length&&-1!==this.form[0].nameId.indexOf("dWater")&&(console.log(this.form[0],96),this.checkallClear("pWater"));var p=this.$store.state.form.event,v=this.$store.state.formParam.event;p.forEach((function(t,i){e.form.forEach((function(e,a){t.channelNo===e.channelNo&&(p[i]["flag"]=!0,v[i]["flag"]=!0)}))})),p=p.filter((function(e){return!e.flag})),v=v.filter((function(e){return!e.flag}));var g={},y={};this.form=this.form.reduce((function(e,t){return!g[t.channelNo]&&(g[t.channelNo]=e.push(t)),e}),[]),this.formParam=this.formParam.reduce((function(e,t){return!y[t.channelNo]&&(y[t.channelNo]=e.push(t)),e}),[]),p=[].concat((0,n.default)(p),(0,n.default)(this.form)),v=[].concat((0,n.default)(v),(0,n.default)(this.formParam)),this.$store.commit("saveform",{form:{event:p},formParam:{event:v}}),history.go(-2)}},goPath:function(e){var t=Object.assign({},e,{cabinetId:this.props.id,productKey:this.props.productKey,isaddEdit:this.props.isaddEdit,rulesId:this.props.rulesId,cabinetName:this.props.cabinetName});uni.navigateTo({url:"/pages/sceneLinkage/add/childPage/device/deviceDetails/deviceDetails?query=".concat(JSON.stringify(t))})}}};t.default=o},"656d":function(e,t,i){"use strict";i.r(t);var a=i("dbbd"),n=i("ef16");for(var r in n)"default"!==r&&function(e){i.d(t,e,(function(){return n[e]}))}(r);i("dc82");var o,s=i("f0c5"),c=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"292ea9a6",null,!1,a["a"],o);t["default"]=c.exports},"877c":function(e,t,i){e.exports=i.p+"static/img/湿帘.6e887d30.svg"},a516:function(e,t,i){e.exports=i.p+"static/img/外遮阳.9648f2d5.svg"},aca8:function(e,t,i){var a=i("24fb");t=a(!1),t.push([e.i,".device-item .pd .head-pd[data-v-292ea9a6]{overflow:hidden;margin:%?20?% auto;padding:%?24?%;box-sizing:border-box;background-color:#fff;font-size:%?28?%;font-family:PingFangSC-Regular,PingFang SC;font-weight:800;color:#323233;position:relative}.device-item .pd .head-pd .pd-switch[data-v-292ea9a6]{position:absolute;right:%?50?%;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.device-item .pd .my-tree-p[data-v-292ea9a6],\n.device-item .pd .my-tree-d[data-v-292ea9a6]{font-size:%?28?%;font-family:PingFangSC-Regular,PingFang SC;font-weight:400;color:#323233}.device-item .pd .my-tree-p[data-v-292ea9a6] .ly-tree-node__content,\n.device-item .pd .my-tree-d[data-v-292ea9a6] .ly-tree-node__content{position:relative;height:%?108?%;border-bottom:%?2?% solid #e6e6e6}.device-item .pd .my-tree-p[data-v-292ea9a6] .ly-tree-node__content .ly-checkbox,\n.device-item .pd .my-tree-d[data-v-292ea9a6] .ly-tree-node__content .ly-checkbox{position:absolute;right:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.device-item .pd .my-tree-p[data-v-292ea9a6] .uni-input-placeholder,\n.device-item .pd .my-tree-d[data-v-292ea9a6] .uni-input-placeholder,\n.device-item .pd .my-tree-p[data-v-292ea9a6] .uni-input-input,\n.device-item .pd .my-tree-d[data-v-292ea9a6] .uni-input-input{text-align:right}.device-item .pd .my-tree-d[data-v-292ea9a6]{margin:%?20?% auto}.device-item .pd .my-tree-d .btn[data-v-292ea9a6]{height:%?108?%;background:#fff;padding:%?24?% %?32?%;box-sizing:border-box}.device-item .pd .chixuTime[data-v-292ea9a6]{height:%?200?%}.device-item .pd .hold[data-v-292ea9a6]{position:fixed;bottom:0;left:0;right:0;height:%?188?%;background-color:#fff;padding-top:%?12?%}.device-item .pd .hold .btn[data-v-292ea9a6]{margin:0 auto;width:%?686?%;height:%?80?%;background:#09b76e;border-radius:%?200?%;line-height:%?80?%;text-align:center;font-size:%?28?%;font-family:PingFangSC-Regular,PingFang SC;font-weight:400;color:#fff}.device-item .qt[data-v-292ea9a6]{overflow:hidden;margin:%?20?% auto;padding:%?24?%;box-sizing:border-box;background-color:#fff}.device-item .qt .only[data-v-292ea9a6]{border-bottom:%?2?% solid #e6e6e6;height:%?108?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-webkit-flex-flow:row nowrap;flex-flow:row nowrap;-webkit-justify-content:space-around;justify-content:space-around;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.device-item .qt .only img[data-v-292ea9a6]{width:%?48?%}.device-item .qt .only .span[data-v-292ea9a6]{width:80%;font-size:%?28?%;font-family:PingFangSC-Regular,PingFang SC;font-weight:400;color:#323233}.device-item .qt .only[data-v-292ea9a6]:last-child{border:none}",""]),e.exports=t},dbbd:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return a}));var a={lyTree:i("f69c").default,uFormItem:i("464f").default,uInput:i("32f4").default,uSelect:i("1262").default,uPicker:i("3c7f").default,uIcon:i("df6c").default},n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"device-item"},[e.isPd?i("div",{staticClass:"pd"},[i("div",{staticClass:"head-pd"},[e._v("状态"),i("van-switch",{staticClass:"pd-switch",attrs:{value:e.checked},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.onInput.apply(void 0,arguments)}}})],1),i("ly-tree",{ref:"tree1",staticClass:"my-tree-p",attrs:{"node-key":"id","expand-on-check-node":!0,"show-checkbox":!e.isRadio,"show-radio":e.isRadio,"check-only-leaf":e.isRadio,"tree-data":e.treelist1,"highlight-current":!0,"default-expanded-keys":e.expandKeys1,"default-checked-keys":e.checkedKeys1,props:e.defaultProps1},on:{check:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheck1.apply(void 0,arguments)}}}),i("ly-tree",{ref:"tree2",staticClass:"my-tree-d",attrs:{"node-key":"id","expand-on-check-node":!0,"show-checkbox":!e.isRadio,"show-radio":e.isRadio,"check-only-leaf":e.isRadio,"tree-data":e.treelist2,"highlight-current":!0,"default-expanded-keys":e.expandKeys2,"default-checked-keys":e.checkedKeys2,props:e.defaultProps2},on:{check:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheck2.apply(void 0,arguments)}}}),i("div",{staticClass:"my-tree-d"},[i("u-form-item",{staticClass:"btn",attrs:{"label-width":"50%",label:"持续时间"}},[i("u-input",{attrs:{placeholder:"持续时间",type:"select"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.durationClick.apply(void 0,arguments)}},model:{value:e.duration,callback:function(t){e.duration=t},expression:"duration"}})],1),i("u-select",{attrs:{title:"持续时间",mode:"single-column",list:e.durationList},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.durationConfirm.apply(void 0,arguments)}},model:{value:e.durationShow,callback:function(t){e.durationShow=t},expression:"durationShow"}}),i("u-picker",{attrs:{mode:"time",params:e.zdyParams},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.zdyConfirm.apply(void 0,arguments)}},model:{value:e.zdyShow,callback:function(t){e.zdyShow=t},expression:"zdyShow"}})],1),i("div",{staticClass:"chixuTime"}),i("div",{staticClass:"hold"},[i("div",{staticClass:"btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.hold.apply(void 0,arguments)}}},[e._v("确定")])])],1):i("div",{staticClass:"qt"},e._l(e.list,(function(t,a){return i("div",{key:a,staticClass:"only",on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.goPath(t)}}},[i("img",{attrs:{src:t.icon,alt:""}}),i("div",{staticClass:"span"},[e._v(e._s(t.name))]),i("div",{staticClass:"icon"},[i("u-icon",{attrs:{name:"arrow-right",color:"#969799",size:"28"}})],1)])})),0)])},r=[]},dc82:function(e,t,i){"use strict";var a=i("2345"),n=i.n(a);n.a},e01e:function(e,t,i){e.exports=i.p+"static/img/内遮阳.82cdd67e.svg"},e6da:function(e,t,i){e.exports=i.p+"static/img/负压风机.405490b9.svg"},ef16:function(e,t,i){"use strict";i.r(t);var a=i("5e64"),n=i.n(a);for(var r in a)"default"!==r&&function(e){i.d(t,e,(function(){return a[e]}))}(r);t["default"]=n.a}}]);